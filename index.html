<script type="module">
    // استيراد Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    // إعداد Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBLozqHT0vU9_E9nX5SMHeK80akAwYcP5w",
        authDomain: "resiller-a9868.firebaseapp.com",
        databaseURL: "https://resiller-a9868-default-rtdb.firebaseio.com",
        projectId: "resiller-a9868",
        storageBucket: "resiller-a9868.appspot.com",
        messagingSenderId: "984544326620",
        appId: "1:984544326620:web:87a481597de65a61bb5519"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const clientsRef = ref(database, "clients");

    // إضافة مشترك َثر جديد
    function addClient() {
        const newClientName = document.getElementById("newClientName").value.trim();
        if (newClientName) {
            const newClientRef = push(clientsRef);
            set(newClientRef, { name: newClientName })
                .then(() => {
                    alert("تمت إضافة المشترك بنجاح.");
                    document.getElementById("newClientName").value = "";
                })
                .catch((error) => {
                    console.error("خطأ أثناء إضافة المشترك:", error);
                    alert("حدث خطأ أثناء إضافة المشترك. تحقق من إعدادات Firebase.");
                });
        } else {
            alert("يرجى إدخال اسم المشترك.");
        }
    }

    // تحديث قائمة المشتركين
    function updateClients() {
        const clientSelect = document.getElementById("clientSelect");
        clientSelect.innerHTML = "";

        onValue(clientsRef, (snapshot) => {
            const clients = snapshot.val();
            if (clients) {
                Object.keys(clients).forEach((key) => {
                    const client = clients[key];
                    const option = document.createElement("option");
                    option.value = key;
                    option.textContent = client.name;
                    clientSelect.appendChild(option);
                });
            } else {
                console.log("لا يوجد مشتركين حاليًا.");
            }
        }, (error) => {
            console.error("خطأ أثناء قراءة البيانات:", error);
        });
    }

    // تحديث البيانات عند تحميل الصفحة
    updateClients();
</script>
